 /*
  WPS Request Builder, a javascript request builder for OGC-WPS Requests.
  (c) 2013-2014, Christian WÃ¶rner
 */
!function(e,t){"function"==typeof define&&define.amd?define(function(){return e.wpsBuilder=t()}):e.wpsBuilder=t()}(this,function(e){return e={},e.makeExecuteDocument=function(){var e,t="xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'  xmlns='http://www.opengis.net/wps/1.0.0'  xmlns:wfs='http://www.opengis.net/wfs'  xmlns:wps='http://www.opengis.net/wps/1.0.0' xmlns:ows='http://www.opengis.net/ows/1.1' xmlns:gml='http://www.opengis.net/gml' xmlns:ogc='http://www.opengis.net/ogc' xmlns:wcs='http://www.opengis.net/wcs/1.1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xsi:schemaLocation='http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd'";return e=(new DOMParser).parseFromString("<wps:Execute version='1.0.0' service='WPS' "+t+"></wps:Execute>","application/xml")},e.makeExecuteNode=function(e){var t=e.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Execute");return t.setAttribute("version","1.0.0"),t.setAttribute("service","WPS"),t},e.addIdentifier=function(e,t,n){var p=t.createElementNS("http://www.opengis.net/ows/1.1","ows:Identifier"),s=t.createTextNode(e);p.appendChild(s),n.appendChild(p)},e.addInputs=function(t,n,p){for(var s,i=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:DataInputs"),r=0;r<t.length;r++)s=e.addInput(t[r],n,p),i.appendChild(s);p.appendChild(i)},e.addInput=function(t,n){var p,s,i,r,w,a,d,o,l,c,m,u,h,f,g=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Input"),x=n.createElementNS("http://www.opengis.net/ows/1.1","ows:Identifier"),C=n.createTextNode(t.identifier);if(g.appendChild(x),t.mimeType)p=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Data"),s=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:ComplexData"),s.setAttribute("mimeType",t.mimeType),i=n.createCDATASection(t.data),s.appendChild(i),p.appendChild(s),g.appendChild(p);else if(t.reference)r=n.createElement("wps:Reference"),w=n.createElement("wps:Body"),"wfs"===t.reference.type?(r.setAttribute("mimeType","text/xml"),r.setAttribute("xlink:href","http://geoserver/wfs"),r.setAttribute("method","POST"),a=n.createElement("wfs:GetFeature"),a.setAttribute("xmlns:wfs","http://www.opengis.net/wfs"),a.setAttribute("xmlns:"+t.typeName.split(":")[0],t.typeNamespace||"http://www.openplans.org/topp"),a.setAttribute("service","WFS"),a.setAttribute("version","1.0.0"),a.setAttribute("outputFormat","GML2"),d=n.createElement("wfs:Query"),d.setAttribute("typeName",t.typeName),r.appendChild(w),w.appendChild(a),a.appendChild(d),g.appendChild(r)):"wcs"===t.reference.type&&(r.setAttribute("mimeType","image/tiff"),r.setAttribute("xlink:href","http://geoserver/wcs"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttribute("method","POST"),o=n.createElementNS("http://www.opengis.net/ows/1.1","ows:Identifier"),l=n.createTextNode(t.reference.identifier),o.appendChild(l),c=n.createElementNS("http://www.opengis.net/wcs/1.1.1","wcs:GetCoverage"),c.setAttribute("service","WCS"),c.setAttribute("version","1.1.1"),c.appendChild(o),m=n.createElement("wcs:DomainSubset"),u=n.createElement("wcs:Output"),u.setAttribute("format","image/tiff"),c.appendChild(m),c.appendChild(u),w.appendChild(c),r.appendChild(w),g.appendChild(r));else if(t.subprocess){var b=t.subprocess,S=e.makeExecuteNode(n);w=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Body"),r=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Reference"),r.setAttribute("mimeType",t.mimeType?t.mimeType:"text/xml; subtype=gml/3.1.1"),r.setAttribute("xlink:href","http://geoserver/wps"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttribute("method","POST"),r.appendChild(w),w.appendChild(S),e.addIdentifier(b.identifier,n,S),e.addInputs(b.inputs,n,S),e.addResponseForm(b.response,n,S),g.appendChild(r)}else p=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:Data"),h=n.createElementNS("http://www.opengis.net/wps/1.0.0","wps:LiteralData"),f=n.createTextNode(t.data),h.appendChild(f),p.appendChild(h),g.appendChild(p);return x.appendChild(C),g},e.addResponseForm=function(e,t,n){var p=t.createElementNS("http://www.opengis.net/wps/1.0.0","wps:ResponseForm"),s=t.createElementNS("http://www.opengis.net/wps/1.0.0","wps:RawDataOutput");e.mimeType&&s.setAttribute("mimeType",e.mimeType);var i=t.createElementNS("http://www.opengis.net/ows/1.1","ows:Identifier"),r=t.createTextNode(e.identifier);i.appendChild(r),s.appendChild(i),p.appendChild(s),n.appendChild(p)},e.build=function(t){return e.docu=e.makeExecuteDocument(),e.exec=e.docu.firstChild,e.addIdentifier(t.identifier,e.docu,e.exec),e.addInputs(t.inputs,e.docu,e.exec),e.addResponseForm(t.response,e.docu,e.exec),e.docu},e.serialize=function(e){var t=new XMLSerializer;return t.serializeToString(e)},e.transport={},e.transport._sendQuery=function(t,n,p,s){s=s||{};var i={dataType:"json",url:t,success:p};s.completeCallback&&(i.complete=function(){s.completeCallback()}),s.errorCallback&&(i.error=s.errorCallback),s.trackLoading&&(i.progress=s.trackLoading);var r=new XMLHttpRequest;return r.open("POST",i.url,!0),r.onreadystatechange=function(){4===r.readyState&&200===r.status&&i.success(r)},r.send(n),e.transport.currentAjax=r,r},e});