 /*
  WPS Request Builder, a javascript request builder for OGC-WPS Requests.
  (c) 2013-2014, Christian WÃ¶rner
 */
!function(e,t){"function"==typeof define&&define.amd?define(function(){return e.wpsBuilder=t()}):e.wpsBuilder=t()}(this,function(e){return e={},e.makeExecuteDocument=function(){var e,t="xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'  xmlns='http://www.opengis.net/wps/1.0.0'  xmlns:wfs='http://www.opengis.net/wfs'  xmlns:wps='http://www.opengis.net/wps/1.0.0' xmlns:ows='http://www.opengis.net/ows/1.1' xmlns:gml='http://www.opengis.net/gml' xmlns:ogc='http://www.opengis.net/ogc' xmlns:wcs='http://www.opengis.net/wcs/1.1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xsi:schemaLocation='http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd'";return e=(new DOMParser).parseFromString("<wps:Execute version='1.0.0' service='WPS' "+t+"></wps:Execute>","application/xml")},e.makeExecuteNode=function(e){var t=e.createElementNS("http://www.opengis.net/wps/1.0.0","Execute");return t.setAttribute("version","1.0.0"),t.setAttribute("service","WPS"),t},e.addIdentifier=function(e,t,n){var p=t.createElementNS("http://www.opengis.net/ows/1.1","Identifier"),i=t.createTextNode(e);p.appendChild(i),n.appendChild(p)},e.addInputs=function(t,n,p){for(var i,s=n.createElementNS("http://www.opengis.net/wps/1.0.0","DataInputs"),r=0;r<t.length;r++)i=e.addInput(t[r],n,p),s.appendChild(i);p.appendChild(s)},e.addInput=function(t,n){var p,i,s,r,w,a,d,o,c,l,m,u,h,f,g=n.createElementNS("http://www.opengis.net/wps/1.0.0","Input"),x=n.createElementNS("http://www.opengis.net/ows/1.1","Identifier"),S=n.createTextNode(t.identifier);if(g.appendChild(x),t.mimeType&&"image/tiff"!==t.mimeType)p=n.createElementNS("http://www.opengis.net/wps/1.0.0","Data"),i=n.createElementNS("http://www.opengis.net/wps/1.0.0","ComplexData"),i.setAttribute("mimeType",t.mimeType),s=n.createCDATASection(t.data),i.appendChild(s),p.appendChild(i),g.appendChild(p);else if(t.reference)r=n.createElementNS("http://www.opengis.net/wps/1.0.0","Reference"),w=n.createElementNS("http://www.opengis.net/wps/1.0.0","Body"),"wfs"===t.reference.type?(r.setAttribute("mimeType","text/xml"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","http://geoserver/wfs"),r.setAttribute("method","POST"),a=n.createElementNS("http://www.opengis.net/wfs","GetFeature"),a.setAttribute(t.typeName.split(":")[0],t.typeNamespace||"http://www.openplans.org/topp"),a.setAttribute("service","WFS"),a.setAttribute("version","1.0.0"),a.setAttribute("outputFormat","GML2"),d=n.createElementNS("http://www.opengis.net/wfs","Query"),d.setAttribute("typeName",t.typeName),r.appendChild(w),w.appendChild(a),a.appendChild(d),g.appendChild(r)):"wcs"===t.reference.type&&(r.setAttribute("mimeType","image/tiff"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","http://geoserver/wcs"),r.setAttribute("method","POST"),o=n.createElementNS("http://www.opengis.net/ows/1.1","Identifier"),c=n.createTextNode(t.reference.identifier),o.appendChild(c),l=n.createElementNS("http://www.opengis.net/wcs/1.1.1","GetCoverage"),l.setAttribute("service","WCS"),l.setAttribute("version","1.1.1"),l.appendChild(o),m=n.createElementNS("http://www.opengis.net/wcs/1.1.1","DomainSubset"),u=n.createElementNS("http://www.opengis.net/wcs/1.1.1","Output"),u.setAttribute("format","image/tiff"),l.appendChild(m),l.appendChild(u),w.appendChild(l),r.appendChild(w),g.appendChild(r));else if(t.subprocess){var C=t.subprocess,N=e.makeExecuteNode(n);w=n.createElementNS("http://www.opengis.net/wps/1.0.0","Body"),r=n.createElementNS("http://www.opengis.net/wps/1.0.0","Reference"),r.setAttribute("mimeType",t.mimeType?t.mimeType:"text/xml; subtype=gml/3.1.1"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","http://geoserver/wps"),r.setAttribute("method","POST"),r.appendChild(w),w.appendChild(N),e.addIdentifier(C.identifier,n,N),e.addInputs(C.inputs,n,N),e.addResponseForm(C.response,n,N),g.appendChild(r)}else p=n.createElementNS("http://www.opengis.net/wps/1.0.0","Data"),h=n.createElementNS("http://www.opengis.net/wps/1.0.0","LiteralData"),f=n.createTextNode(t.data),h.appendChild(f),p.appendChild(h),g.appendChild(p);return x.appendChild(S),g},e.addResponseForm=function(e,t,n){var p=t.createElementNS("http://www.opengis.net/wps/1.0.0","ResponseForm"),i=t.createElementNS("http://www.opengis.net/wps/1.0.0","RawDataOutput");e.mimeType&&i.setAttribute("mimeType",e.mimeType);var s=t.createElementNS("http://www.opengis.net/ows/1.1","Identifier"),r=t.createTextNode(e.identifier);s.appendChild(r),i.appendChild(s),p.appendChild(i),n.appendChild(p)},e.build=function(t){return e.docu=e.makeExecuteDocument(),e.exec=e.docu.firstChild,e.addIdentifier(t.identifier,e.docu,e.exec),e.addInputs(t.inputs,e.docu,e.exec),e.addResponseForm(t.response,e.docu,e.exec),e.docu},e.serialize=function(e){var t=new XMLSerializer;return t.serializeToString(e)},e.transport={},e.transport._sendQuery=function(t,n,p,i){i=i||{};var s={dataType:"json",url:t,success:p};i.completeCallback&&(s.complete=function(){i.completeCallback()}),i.errorCallback&&(s.error=i.errorCallback),i.trackLoading&&(s.progress=i.trackLoading);var r=new XMLHttpRequest;return r.open("POST",s.url,!0),r.onreadystatechange=function(){4===r.readyState&&200===r.status&&s.success(r)},r.send(n),e.transport.currentAjax=r,r},e});